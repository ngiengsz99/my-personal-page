[{"id":"fe0622d9b263dfa9","type":"tab","label":"myCustomNewspaper","disabled":false,"info":"-Grab new Quarterly Reports\n-Record Income and Expenses"},{"id":"245abf22a7556805","type":"group","z":"fe0622d9b263dfa9","name":"Command List","style":{"label":true},"nodes":["3fbf9901193b6490","cbd8605909ab5479","e570d5b8c6d69141"],"x":74,"y":699,"w":642,"h":82},{"id":"c384ed6560d6fa4f","type":"group","z":"fe0622d9b263dfa9","name":"Personal Finance Tracker","style":{"label":true},"nodes":["384a79f9e755053a","28a3e944db786990"],"x":68,"y":253,"w":1084,"h":374},{"id":"384a79f9e755053a","type":"group","z":"fe0622d9b263dfa9","g":"c384ed6560d6fa4f","name":"Send Data Saved Confirmation Telegram Msg","style":{"label":true},"nodes":["abff8e894bc32bc8","8d552c09e804889d","e9351f1c402b2e37"],"x":94,"y":519,"w":582,"h":82},{"id":"28a3e944db786990","type":"group","z":"fe0622d9b263dfa9","g":"c384ed6560d6fa4f","name":"Read Response from Tele and Save Data","style":{"label":true},"nodes":["38d62e0fba0dcc6d","8e58e272ba8dd611","9e962fb7f83c257c","c4b68efa38b74dc7","3fea171e3a8c0671","246c3266ab9fb0da","e0406cde29278ce6","d3c541f2d1b2f913","c1f373ba634f9004","27244ea2f5b22489","a9864bc5d696b0ed","47719d1faab1c79d"],"x":94,"y":279,"w":1032,"h":205.75},{"id":"e70c132f118d3d3c","type":"group","z":"fe0622d9b263dfa9","name":"Daily QR Report Check","style":{"label":true},"nodes":["5039d4e1254c5aed","755401f3053b345f","4251f348254aec0b","2f2834505dad6873","5c3fe2d765e74999","d453fe861da58051","5e61692ac06ef6c5"],"x":54,"y":39,"w":1162,"h":162},{"id":"5039d4e1254c5aed","type":"exec","z":"fe0622d9b263dfa9","g":"e70c132f118d3d3c","command":"python3 /home/pi/myCustomNewspaper_Project/financialReportCapturing.py","addpay":"","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"Run Quarterly Report Check","x":420,"y":120,"wires":[["2f2834505dad6873"],["5e61692ac06ef6c5"],[]]},{"id":"755401f3053b345f","type":"inject","z":"fe0622d9b263dfa9","g":"e70c132f118d3d3c","name":"Repeat every 8am","props":[],"repeat":"","crontab":"00 08 * * *","once":false,"onceDelay":0.1,"topic":"","x":190,"y":120,"wires":[["5039d4e1254c5aed"]]},{"id":"4251f348254aec0b","type":"function","z":"fe0622d9b263dfa9","g":"e70c132f118d3d3c","name":"Got Report Response","func":"var result = msg.payload.substr(2,msg.payload.length-5);\nconst company_list = result.split(\"', '\");\nvar message_body = \"\";\nvar now = new Date();\nvar yyyy = now.getFullYear();\nvar mm = now.getMonth() < 9? \"0\" + (now.getMonth()+1) : (now.getMonth() + 1);\nvar dd = now.getDate() < 10? \"0\" + (now.getDate()) : (now.getDate());\nvar date_today = `${yyyy}-${mm}-${dd}`\n\nmessage_head = \"Date Today: \" + date_today + \"\\n ðŸ“ŠNew Quarterly Reports: \\n\\n\";\n\nfor (let i = 0; i< company_list.length;i++){\n    message_body += `${i+1}) ${company_list[i]}\\n`\n}\n\nend_url = \"\\nURL to check Quarterly Reports -->\" + \"https://www.klsescreener.com/v2/financial-reports\"\n\nfinal_message = message_head + message_body + end_url;\n\nmsg.payload = {\n    \"content\":final_message,\n    \"chatId\": 1117416272,\n    \"type\": \"message\",\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":900,"y":140,"wires":[["d453fe861da58051"]]},{"id":"2f2834505dad6873","type":"switch","z":"fe0622d9b263dfa9","g":"e70c132f118d3d3c","name":"Got Updates?","property":"payload","propertyType":"msg","rules":[{"t":"regex","v":"empty","vt":"str","case":false},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":660,"y":100,"wires":[["5c3fe2d765e74999"],["4251f348254aec0b"]]},{"id":"5c3fe2d765e74999","type":"function","z":"fe0622d9b263dfa9","g":"e70c132f118d3d3c","name":"No Update Telegram Response","func":"var now = new Date();\nvar yyyy = now.getFullYear();\nvar mm = now.getMonth() < 9? \"0\" + (now.getMonth()+1) : (now.getMonth() + 1);\nvar dd = now.getDate() < 10? \"0\" + (now.getDate()) : (now.getDate() + 1);\nvar date_today = `${yyyy}-${mm}-${dd}`\n\nfinal_message = \"Date Today: \" + date_today + \"\\nThere are no updates on the Quarterly Report today.ðŸ˜\"\n\nmsg.payload = {\n    \"content\":final_message,\n    \"chatId\": 1117416272,\n    \"type\": \"message\",\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":930,"y":80,"wires":[["d453fe861da58051"]]},{"id":"4c2e1d6f5ce91cd0","type":"telegram sender","z":"fe0622d9b263dfa9","name":"","bot":"9a74315f1f55321a","haserroroutput":false,"outputs":1,"x":1430,"y":140,"wires":[[]]},{"id":"9bba69eb7e457a95","type":"comment","z":"fe0622d9b263dfa9","name":"","info":"For Emoji: \nhttps://apps.timwhitlock.info/emoji/tables/unicode","x":1440,"y":40,"wires":[]},{"id":"38d62e0fba0dcc6d","type":"telegram receiver","z":"fe0622d9b263dfa9","g":"28a3e944db786990","name":"","bot":"9a74315f1f55321a","saveDataDir":"","filterCommands":true,"x":210,"y":320,"wires":[["8e58e272ba8dd611"],[]]},{"id":"8e58e272ba8dd611","type":"function","z":"fe0622d9b263dfa9","g":"28a3e944db786990","name":"If else ","func":"if (msg.payload.content.slice(0,7) === \"/Income\"){\n    msg.payload = msg.payload.content.split(\"-\");\n    msg.topic = \"income\";\n    flow.set(\"chatter\",msg.originalMessage.chat.id)\n}\nelse if (msg.payload.content.slice(0,4) === \"/Exp\"){\n    msg.payload = msg.payload.content.split(\"-\");\n    msg.topic = \"expense\";\n    flow.set(\"chatter\",msg.originalMessage.chat.id)\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":390,"y":320,"wires":[["47719d1faab1c79d"]]},{"id":"abff8e894bc32bc8","type":"function","z":"fe0622d9b263dfa9","g":"384a79f9e755053a","name":"Confirmation Telegram Message","func":"var final_message = \"All Done âœŒ  ! Your \" + msg.topic + \" has been recorded.\" ;\n\nmsg.payload = {\n    \"content\":final_message,\n    \"chatId\": flow.get(\"chatter\"),\n    \"type\": \"message\",\n}\n\nreturn [ msg ];\n","outputs":"1","noerr":0,"initialize":"","finalize":"","libs":[],"x":430,"y":560,"wires":[["e9351f1c402b2e37"]]},{"id":"9e962fb7f83c257c","type":"function","z":"fe0622d9b263dfa9","g":"28a3e944db786990","name":"Data Categorization","func":"msg.payload = {\n    \"category\": msg.topic,\n    \"event\":msg.payload[1],\n    \"amount\": msg.payload[2]\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":720,"y":320,"wires":[["c4b68efa38b74dc7"]]},{"id":"c4b68efa38b74dc7","type":"function","z":"fe0622d9b263dfa9","g":"28a3e944db786990","name":"Filename generator","func":"// Get the current time and convert it to text\nvar now = new Date();\nvar yyyy = now.getFullYear();\nvar mm = now.getMonth() < 9 ? \"0\" + (now.getMonth() + 1) : (now.getMonth() + 1); // getMonth() is zero-based\nvar dd  = now.getDate() < 10 ? \"0\" + now.getDate() : now.getDate();\nvar hh = now.getHours() < 10 ? \"0\" + now.getHours() : now.getHours();\nvar mmm  = now.getMinutes() < 10 ? \"0\" + now.getMinutes() : now.getMinutes();\nvar ss  = now.getSeconds() < 10 ? \"0\" + now.getSeconds() : now.getSeconds();\n\n// Generate out file name pattern\nmsg.fname = \"Personal_Finance_\"+ yyyy + \"_\"+ mm+\".csv\";\n// Full filename with path for the file node later\nmsg.filename = \"/home/pi/myCustomNewspaper_Project/Excel Records/\"+msg.fname;\n// msg.filename = \"C:/Users/Huawei/Desktop/test/\"+msg.fname;\n\n// We save the current payload into a different place on the msg object\nmsg.filecontent = msg.payload;\n\n// We are passing the file name search pattern to fs node to tell us if the file exists or not\nmsg.payload = {\"pattern\":msg.fname};\n\nnode.status({fill:\"blue\",shape:\"ring\",text:msg.fname});\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":250,"y":400,"wires":[["a9864bc5d696b0ed"]]},{"id":"3fea171e3a8c0671","type":"switch","z":"fe0622d9b263dfa9","g":"28a3e944db786990","name":"","property":"$count(msg.payload)","propertyType":"jsonata","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":610,"y":400,"wires":[["246c3266ab9fb0da"],["e0406cde29278ce6"]]},{"id":"246c3266ab9fb0da","type":"function","z":"fe0622d9b263dfa9","g":"28a3e944db786990","name":"Set data","func":"var now = new Date();\nvar dd  = now.getDate() < 10 ? \"0\" + now.getDate() : now.getDate();\nvar mm = now.getMonth() < 9 ? \"0\" + (now.getMonth() + 1) : (now.getMonth() + 1); // getMonth() is zero-based\nvar yyyy = now.getFullYear();\n\n\nmsg.payload = {\n    \"date\": dd + \"-\" + mm + \"-\" + yyyy,\n    \"category\": msg.filecontent[\"category\"],\n    \"event\": msg.filecontent[\"event\"],\n    \"amount\": msg.filecontent[\"amount\"],\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":780,"y":380,"wires":[["d3c541f2d1b2f913"]]},{"id":"e0406cde29278ce6","type":"function","z":"fe0622d9b263dfa9","g":"28a3e944db786990","name":"Set data","func":"var now = new Date();\nvar dd  = now.getDate() < 10 ? \"0\" + now.getDate() : now.getDate();\nvar mm = now.getMonth() < 9 ? \"0\" + (now.getMonth() + 1) : (now.getMonth() + 1); // getMonth() is zero-based\nvar yyyy = now.getFullYear();\n\n\nmsg.payload = {\n    \"date\": dd + \"-\" + mm + \"-\" + yyyy,\n    \"category\": msg.filecontent[\"category\"],\n    \"event\": msg.filecontent[\"event\"],\n    \"amount\": msg.filecontent[\"amount\"],\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":778.75,"y":443.75,"wires":[["27244ea2f5b22489"]]},{"id":"d3c541f2d1b2f913","type":"csv","z":"fe0622d9b263dfa9","g":"28a3e944db786990","name":"","sep":",","hdrin":"","hdrout":"all","multi":"one","ret":"\\r\\n","temp":"date,category,event,amount","skip":"0","strings":true,"include_empty_strings":false,"include_null_values":false,"x":930,"y":380,"wires":[["c1f373ba634f9004"]]},{"id":"c1f373ba634f9004","type":"file","z":"fe0622d9b263dfa9","g":"28a3e944db786990","name":"","filename":"","appendNewline":false,"createDir":false,"overwriteFile":"false","encoding":"none","x":1085,"y":400,"wires":[[]],"l":false},{"id":"27244ea2f5b22489","type":"csv","z":"fe0622d9b263dfa9","g":"28a3e944db786990","name":"","sep":",","hdrin":"","hdrout":"none","multi":"one","ret":"\\r\\n","temp":"date,category,event,amount","skip":"0","strings":true,"include_empty_strings":false,"include_null_values":false,"x":930,"y":440,"wires":[["c1f373ba634f9004"]]},{"id":"a9864bc5d696b0ed","type":"fs-file-lister","z":"fe0622d9b263dfa9","g":"28a3e944db786990","name":"","start":"/home/pi/myCustomNewspaper_Project/Excel Records","pattern":"*.*","folders":"*","hidden":true,"lstype":"files","path":true,"single":true,"depth":0,"stat":true,"showWarnings":false,"x":440,"y":400,"wires":[["3fea171e3a8c0671"]]},{"id":"8d552c09e804889d","type":"complete","z":"fe0622d9b263dfa9","g":"384a79f9e755053a","name":"","scope":["c1f373ba634f9004"],"uncaught":false,"x":190,"y":560,"wires":[["abff8e894bc32bc8"]]},{"id":"47719d1faab1c79d","type":"switch","z":"fe0622d9b263dfa9","g":"28a3e944db786990","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"income","vt":"str"},{"t":"eq","v":"expense","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":530,"y":320,"wires":[["9e962fb7f83c257c"],["9e962fb7f83c257c"]]},{"id":"3fbf9901193b6490","type":"telegram command","z":"fe0622d9b263dfa9","g":"245abf22a7556805","name":"/help_pf","command":"/help_pf","description":"Show how to key in finances","registercommand":true,"language":"en","scope":"default","bot":"9a74315f1f55321a","strict":false,"hasresponse":false,"useregex":false,"removeregexcommand":false,"outputs":1,"x":150,"y":740,"wires":[["cbd8605909ab5479"]]},{"id":"cbd8605909ab5479","type":"function","z":"fe0622d9b263dfa9","g":"245abf22a7556805","name":"Personal Finance Help Telegram Msg","func":"var final_message = \n`ðŸ“ How to key in your Finances:\n\nðŸ¤‘ For Income: \nType \"/Income-(Event Name)-(Amount)\"\n\nðŸ’¸ For Expenses:\nType \"/Exp-(Event Name)-(Amount)\"\n`;\n\nflow.set(\"chatter\",msg.originalMessage.chat.id)\nmsg.payload = {\n    \"content\":final_message,\n    \"chatId\": flow.get(\"chatter\"),\n    \"type\": \"message\",\n}\n\nreturn [ msg ];\n","outputs":"1","noerr":0,"initialize":"","finalize":"","libs":[],"x":420,"y":740,"wires":[["e570d5b8c6d69141"]]},{"id":"d453fe861da58051","type":"link out","z":"fe0622d9b263dfa9","g":"e70c132f118d3d3c","name":"QR_Report_out","links":["36371c505b855bb1","691f06336bc8095c"],"x":1175,"y":120,"wires":[]},{"id":"36371c505b855bb1","type":"link in","z":"fe0622d9b263dfa9","name":"All_in","links":["d453fe861da58051","e9351f1c402b2e37","e570d5b8c6d69141"],"x":1265,"y":140,"wires":[["4c2e1d6f5ce91cd0"]]},{"id":"e9351f1c402b2e37","type":"link out","z":"fe0622d9b263dfa9","g":"384a79f9e755053a","name":"All_done_out","links":["36371c505b855bb1"],"x":635,"y":560,"wires":[]},{"id":"e570d5b8c6d69141","type":"link out","z":"fe0622d9b263dfa9","g":"245abf22a7556805","name":"help_out","links":["36371c505b855bb1"],"x":675,"y":740,"wires":[]},{"id":"5e61692ac06ef6c5","type":"debug","z":"fe0622d9b263dfa9","g":"e70c132f118d3d3c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":640,"y":160,"wires":[]},{"id":"78034690.513038","type":"telegram sender","z":"fe0622d9b263dfa9","name":"show inline keyboard","bot":"","outputs":1,"x":780,"y":1500,"wires":[[]]},{"id":"74e8cf35.a5ba8","type":"function","z":"fe0622d9b263dfa9","name":"inline keyboard message","func":"var opts = {\n  reply_to_message_id: msg.payload.messageId,\n  reply_markup: JSON.stringify({\n    \"inline_keyboard\": [[\n                {\n                    \"text\": \"Yes\",\n                    \"callback_data\": \"FOO YES\"            \n                }, \n                {\n                    \"text\": \"No\",\n                    \"callback_data\": \"FOO NO\"            \n                }]\n            ]\n  })\n};\n\nmsg.payload.content = 'Are you sure?';\nmsg.payload.options = opts;\n\nreturn [ msg ];\n","outputs":"1","noerr":0,"initialize":"","finalize":"","libs":[],"x":510,"y":1500,"wires":[["78034690.513038"]]},{"id":"67692ad7.9de0d4","type":"telegram command","z":"fe0622d9b263dfa9","name":"/foo","command":"/foo","bot":"","strict":false,"hasresponse":false,"outputs":2,"x":210,"y":1500,"wires":[["74e8cf35.a5ba8"],[]]},{"id":"9a74315f1f55321a","type":"telegram bot","botname":"myCustomNewspaper_Bot","usernames":"","chatids":"1117416272","baseapiurl":"","updatemode":"polling","pollinterval":"4000","usesocks":false,"sockshost":"","socksprotocol":"socks5","socksport":"6667","socksusername":"anonymous","sockspassword":"","bothost":"","botpath":"","localbotport":"8443","publicbotport":"8443","privatekey":"","certificate":"","useselfsignedcertificate":false,"sslterminated":false,"verboselogging":false}]